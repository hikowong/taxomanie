<!-- MENU : BEGINNING______________________________________________________________________ -->
<center> <b> Home </b> </center>
<a href="." class="path" title="Go to import collection page"> Upload Collection </a>
<a href="help?id=<%$_id_%>" class="path" title="(?) Help contents"> Help Contents </a>
<a href="about?id=<%$_id_%>" class="path" title="About PhyloExplorer project..."> About </a>
<br />
<center> <b>Current collection</b> </center>
<a href="statistics?id=<%$ _id_ %>" class="path" title="Display statistics of collection"> Statistics </a>
<a href="/downloadCollection?id=<%$ _id_ %>" class="path" title="Download the (full or filtered) collection">Download collection</a>
<br />
<!-- MENU : END -->
     </td>
             <td class="content">
<!-- CONTENU : BEGINNING____________________________________________________________________ -->
<!-- query panel -->
<div class="query">
<form action="check" class="nopadding">
<input size=60  type=text 
onfocus="if(this.value=='YOUR QUERY... (You can download your result)'){this.value='';}" 
onblur="if(this.value==''){this.value='YOUR QUERY... (You can download your result)';}"
<%
if _query_:
    #
%>
value="<%$ _query_ %>"
<%
else:
    #
%>
value="YOUR QUERY... (You can download your result)"
<%|%>
name="query" /> 
<input type="submit" value="Search" class="button">
<input type="hidden" name="id" value="<%$ _id_ %>" />
</form>
<%
if _query_:
    #
%>
    Results for --&nbsp;<%$ _query_ %>&nbsp;--&nbsp;|&nbsp;<a href=check?id=<%$ _id_ %>&clear_query=1>Back to full collection</a>
<%
else:
    _query_ = ""
#
%>
</div>

<%
if _msg_:
    #
%>
    <div  class="error"><%$ _msg_ %></div>
<%|%>

<%#
Navigation buttons beetween trees
#%>

<!-- tree browser -->
<form action="check" class="browser">

<%
if len(_collection_) > 1:
    if _index_ > 1:
        #
%>
        &nbsp;<a href='check?id=<%$ _id_ %>&index=<%$ _index_-1 %>'>Previous</a>&nbsp;
    <%|%>

    <input type="hidden" name="id" value="<%$ _id_ %>" />
    <input type="text" size="5" value="<%$ _index_ %>" name="index" />
    /<%$ len(_collection_) %>

<%
    if _index_ < len(_collection_):
        #
%>
        &nbsp;<a href='check?id=<%$ _id_ %>&index=<%$ _index_+1 %>'>Next</a>&nbsp;
<%|%>
</form>
<!-- tree or not -->

<%
htmltree = ""
if len( _collection_ ) == 0:
    #
%>
   <div class="error">Empty collection</div>
<%
else:
    tree = _collection_[_index_-1]
    if tree:
        if 1:#try:
            from phylogenictree import PhylogenicTree
            htmltree += "<div class='treeName'>Tree Name : "+str(tree["name"])
            if not _cache_.has_key( tree["name"] ):
                ptree = PhylogenicTree( tree["tree"], _reference_ )
                _cache_["nbtaxa"] = ptree.nb_taxa
                _cache_[tree["name"]] = ptree.display()
            htmltree += "  ("+str(_cache_["nbtaxa"])+" taxa)</div><br />"
            htmltree += _cache_[tree["name"]]
        else:#except:
            #
%>
            <!-- error in the tree -->
            <div id="error" class="error"> An error occured with this tree : <%$ tree["tree"] %> </div><br />
        <%|%>

<%
if _nbbadtaxa_:
    #
%>
    <center>
    <font color="red"> <%$ _nbbadtaxa_ %> bad taxa in this collection </font><br /><br />
    </center>
<%|%>
    <a href="#bottom" class="posPage">&nbsp;Go to bottom&nbsp;</a>
    &nbsp;
    &nbsp;
    &nbsp;
    <a id="iNode" onClick="javascript:setNode();" 
      title="Click to show/hide intern node">Show/Hide intern nodes</a>
    &nbsp;
    <a id="toggleallparents" class="posPage" onClick="javascript:toggleInternNode();" 
      title="Click to show/hide all parents">Show/Hide all parents</a>
    <!-- Tree visualization -->
    <div class="tree">
    <br />
    <tt>
    <%$ htmltree %>
    </tt>
    <br />
    </div>
    <a href="#top" class="posPage">&nbsp;Go to top&nbsp;</a>

    <!-- div preview -->
    <div id="preview"></div>
<%|%>
<!-- CONTENT : END -->

