{% extends "base.html" %}

{% block pagedef %} Home > Statistics {% endblock %}

{% block script %}
<script type="text/javascript"> 
$(document).ready(function() { 
    $('#suggestions').text('Processing...');
    $('#suggestions').load( "suggestions" ); 
}); 
$(document).ready(function(){
//    $("#exemplequery").hide();
    $("#exemplelink").click(function () {
        $("#exemplequery").slideToggle("slow");
    });
});
function unselectAll(){
    $(document).ready( function(){
       $("input.restrict").removeAttr( "checked" );
    });
}
function selectAll(){
    $(document).ready( function(){
       $("input.restrict").attr( "checked", "checked" );
    });
}
function selectGenre( genre ){
    $(document).ready( function(){
        if( $("span[genre="+genre+"] input").attr("check")){
           $("span[genre="+genre+"] input").removeAttr( "check" );
           $("span[genre="+genre+"] input").removeAttr( "checked" );
        }
        else{
            $("span[genre="+genre+"]  input").attr("check", "check");
            $("span[genre="+genre+"]  input").attr("checked", "checked");
        }
    });
}
</script>
{% endblock %}

{% block menu %}
<!-- <a href="home" class="path" title="Go home">Home</a> -->
<center> <b> Home </b> </center>
<a href="." class="path" title="Go to upload collection page">Upload Collection</a>
<a href="/phyloexplorer/help" class="path" title="(?) Help contents">Help Contents</a>
<a href="/phyloexplorer/about" class="path" title="About PhyloExplorer project...">About</a>
<br />
{% if not_empty_collection %}
<center> <b>Current collection</b> </center>
<a href="/phyloexplorer/browse" blockui="wait" class="path" title="Go back to collection"> Browse collection </a>
<a href="/phyloexplorer/downloadNCBITree" class="path" title="Download the NCBI arborescence">
Download NCBI tree </a>
<a href="/phyloexplorer/downloadCollection" class="path" title="Download the (full or filtered) collection">Download collection</a>
<br />
{% endif %}
{% endblock %}

{% block content %}
<a href="#bottom" class="posPage">&nbsp;Go to the bottom of the page&nbsp;</a>
<br />
<!-- CONTENU : BEGINNING____________________________________________________________________ -->
<div class="stat">
<!-- query panel -->
<div class="query">
<form action="statistics" class="nopadding">
<!-- <a onclick="javascript:toggleExemple();" id="exemplelink"> View exemple </a>&nbsp; -->
<input size=60  type=text 
onfocus="if(this.value=='Your query...'){this.value='';}" 
onblur="if(this.value==''){this.value='Your query...';}"
{% if query %} value="{{query}}" {% else %} value="Your query..." {% endif %}
name="query" /> 
<input type="checkbox" name="treebase"/> query against treebase
<input type="submit" value="Search" class="button" blockui="wait"> <br>
<tt id="exemplequery"> e.g: <b> {muridae} > 2 and {carnivora}==1 and not ({primates} or {laurasiatheria} < 4) </b>
<br /> 
<i>You can download your result after your query</i></tt>
</form>
{% if query %}
    Results for --&nbsp; {{query}} &nbsp;--&nbsp;|&nbsp;<a blockui="wait" href=/phyloexplorer/statistics?clear_query=1>Back to full collection</a>
{% endif %}
</div>
<!-- end query panel -->
{% if error_msg %} <div  class="error">{{ error_msg }}</div>{% endif %}
{% if not_empty_collection %}
</div>
    <br />
    <a name="arbo"></a>
    <fieldset>
        <legend> General information </legend>
        {{ nb_trees}} trees <br />
        {{ nb_taxa }} taxa &nbsp;

    {% if nb_badtaxa %}
        <font color="red"> {{ nb_badtaxa }} bad taxa </font>&nbsp;
    {% endif %}
    {% if nb_homonyms %}
        <font color="orange">{{ nb_homonyms}} homonyms </font>
    {% endif %}
    {% if nb_synonyms %}
        <font color="orange">{{ nb_synonyms}} synonyms </font>
    {% endif %}
</fieldset>
<br />

{% if nb_homonyms or nb_synonyms or nb_commons or nb_badtaxa %}
    <!-- Collection correction -->
    <fieldset>
    <legend> Correct your collection </legend>
    <form action="recreate_collection">
    <!-- homonym fieldset -->
    {% if nb_homonyms %}
        <span class="homonymlist">
        <fieldset>
        <legend> homonym names to scientific names </legend>
        <table>
        <!-- <tr><th>user taxa name</th><th>related scientific names</th></tr> -->
        {% for homonym_name, suggestions in dict_homonyms.iteritems %}
            <tr>
            <td>
            <font color="orange">{{ homonym_name }}</font> :
            </td>
            <td>
            {% for sugg in suggestions %}
                {{ sugg }}
                <input type="radio" name="{{homonym_name}}" value="{{ sugg }}" />
            {% endfor %}
            </td>
            </tr>
        {% endfor %}
        </table>
        </fieldset>
        </span>
    {% endif %}
    <!-- end homonym fieldset -->
    <!-- synonym fieldset -->
    {% if nb_synonyms %}
        <span class="homonymlist">
        <fieldset>
        <legend> synonym names to scientific names </legend>
        <table>
        <!-- <tr><th>user taxa name</th><th>related scientific names</th></tr> -->
        {% for synonym_name, suggestions in dict_synonym.iteritems %}
            <tr>
            <td>
            <font color="orange">{{ synonym_name }}</font> :
            </td>
            <td>
            {% for sugg in suggestions %}
                {{ sugg }}
                <input type="radio" name="{{synonym_name}}" value="{{ sugg }}" />
            {% endfor %}
            </td>
            </tr>
        {% endfor %}
        </table>
        </fieldset>
        </span>
    {% endif %}
    <!-- end synonym fieldset -->
    <!-- common fieldset -->
    {% if nb_commons %}
        <span class="homonymlist">
        <fieldset>
        <legend> common names to scientific names </legend>
        <table>
        <!-- <tr><th>user taxa name</th><th>related scientific names</th></tr> -->
        {% for common_name, suggestions in dict_common.iteritems %}
            <tr>
            <td>
            <font color="orange">{{ common_name }}</font> :
            </td>
            <td>
            {% for sugg in suggestions %}
                {{ sugg }}
                <input type="radio" name="{{common_name}}" value="{{ sugg }}" />
            {% endfor %}
            </td>
            </tr>
        {% endfor %}
        </table>
        </fieldset>
        </span>
    {% endif %}
    <!-- end common fieldset -->
    <!-- badtaxa fieldset -->
    {% if nb_badtaxa %}
        <span id="suggestions" class="homonymlist"> </span>
    {% endif %}
    <!-- end badtaxa fieldset -->

    <input type="submit" value="Correct collection"/>
    </form>
    </fieldset><br />
    <!-- end collection correction -->
{% endif %}

{% if reference_tree %}
<!-- stat1 -->
    <fieldset>
        <legend> Tree size distribution </legend>
        {{ tree_size_distributions|safe }}
    </fieldset>
<!-- end stat1 -->

<!-- stat2 -->
    <fieldset>
        <legend> Taxon frequency distribution </legend>
        <tt>
        {{taxon_frequency_distribution|safe}}
        </tt>
    </fieldset><br />
<!-- end stat2 -->

<!-- NCBI tree -->
    <fieldset>
        <legend> NCBI taxonomy excerpt from user taxa</legend>
        <a class="phylowidget" target="_blank" 
        href="http://www.phylowidget.org/full/index.html?tree='{{ reference_tree }}'"
        title="Display the ncbi tree as graph"> Click to visualize this tree using PhyloWidget </a>
        <br />
        <br />
        <form action="createFilteredCollection">
            <a class="selectall" onclick="javascript:selectAll();"> Select all</a> &nbsp; &nbsp;
            <a class="selectall" onclick="javascript:unselectAll();"> Unselect all </a>
            <br />
            <tt>
             {{ stats_tree|safe }}
            </tt>
        <b> Select the taxa you want to exclude and </b> <br />
        <input type="submit" value="Restrict your trees" />
        </form>
    </fieldset><br />
<!-- end NCBI tree -->
</div>
            <a href="#top" class="posPage">&nbsp;Go to the top of the page&nbsp;</a>
    <!-- div preview -->
    <div id="preview"></div>
{% endif %}
<!-- CONTENT : END -->
{% endif %}
{% endblock %}
